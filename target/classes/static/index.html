<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cultural Fest Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .tagline {
            color: #666;
            font-size: 1.1em;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .card h2 {
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stat-number {
            font-size: 3em;
            font-weight: bold;
            color: #764ba2;
            margin: 10px 0;
        }
        
        .section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: scale(1.05);
        }
        
        .event-list {
            display: grid;
            gap: 15px;
        }
        
        .event-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }
        
        .event-item h3 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .event-details {
            color: #666;
            font-size: 0.9em;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-top: 10px;
        }
        
        .badge-open {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-closed {
            background: #f8d7da;
            color: #721c24;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé≠ Cultural Fest Management System</h1>
            <p class="tagline">Manage events, registrations, and participants seamlessly</p>
        </header>
        
        <!-- Dashboard Stats -->
        <div class="dashboard">
            <div class="card">
                <h2>üìä Total Events</h2>
                <div class="stat-number" id="totalEvents">0</div>
                <p>Upcoming and completed events</p>
            </div>
            <div class="card">
                <h2>üë• Total Users</h2>
                <div class="stat-number" id="totalUsers">0</div>
                <p>Registered participants</p>
            </div>
            <div class="card">
                <h2>‚úÖ Registrations</h2>
                <div class="stat-number" id="totalRegistrations">0</div>
                <p>Active registrations</p>
            </div>
        </div>
        
        <!-- Main Content Tabs -->
        <div class="section">
            <div class="tabs">
                <button class="tab active" onclick="showTab('users')">üë§ Users</button>
                <button class="tab" onclick="showTab('events')">üé™ Events</button>
                <button class="tab" onclick="showTab('registrations')">üìù Registrations</button>
            </div>
            
            <!-- Users Tab -->
            <div id="users" class="tab-content active">
                <h2>Register New User</h2>
                <div class="success-message" id="userSuccess"></div>
                <div class="error-message" id="userError"></div>
                <form id="userForm">
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" id="fullName" required>
                    </div>
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" id="email" required>
                    </div>
                    <div class="form-group">
                        <label>Password *</label>
                        <input type="password" id="password" required>
                    </div>
                    <div class="form-group">
                        <label>Mobile (10 digits) *</label>
                        <input type="text" id="mobile" pattern="[0-9]{10}" required>
                    </div>
                    <div class="form-group">
                        <label>User Role *</label>
                        <select id="userRole" required>
                            <option value="STUDENT">Student</option>
                            <option value="ADMIN">Admin</option>
                            <option value="JUDGE">Judge</option>
                            <option value="VOLUNTEER">Volunteer</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>College ID</label>
                        <input type="text" id="collegeId">
                    </div>
                    <button type="submit">Register User</button>
                </form>
                
                <h2 style="margin-top: 30px;">All Users</h2>
                <div id="userList" class="event-list"></div>
            </div>
            
            <!-- Events Tab -->
            <div id="events" class="tab-content">
                <h2>Create New Event</h2>
                <div class="success-message" id="eventSuccess"></div>
                <div class="error-message" id="eventError"></div>
                <form id="eventForm">
                    <div class="form-group">
                        <label>Event Name *</label>
                        <input type="text" id="eventName" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="eventDescription" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Category *</label>
                        <select id="eventCategory" required>
                            <option value="DANCE">Dance</option>
                            <option value="MUSIC">Music</option>
                            <option value="DRAMA">Drama</option>
                            <option value="LITERARY">Literary</option>
                            <option value="COMEDY">Stand-up Comedy</option>
                            <option value="FASHION">Fashion Show</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Event Type *</label>
                        <select id="eventType" required>
                            <option value="SOLO">Solo</option>
                            <option value="DUET">Duet</option>
                            <option value="GROUP">Group</option>
                            <option value="TEAM">Team</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Event Date *</label>
                        <input type="date" id="eventDate" required>
                    </div>
                    <div class="form-group">
                        <label>Start Time *</label>
                        <input type="time" id="eventStartTime" required>
                    </div>
                    <div class="form-group">
                        <label>Venue *</label>
                        <input type="text" id="venue" required>
                    </div>
                    <div class="form-group">
                        <label>Max Registrations</label>
                        <input type="number" id="maxRegistrations" min="1">
                    </div>
                    <div class="form-group">
                        <label>Registration Start Date *</label>
                        <input type="date" id="registrationStartDate" required>
                    </div>
                    <div class="form-group">
                        <label>Registration End Date *</label>
                        <input type="date" id="registrationEndDate" required>
                    </div>
                    <div class="form-group">
                        <label>Registration Fee (‚Çπ)</label>
                        <input type="number" id="registrationFee" min="0" step="0.01" value="0">
                    </div>
                    <div class="form-group">
                        <label>Coordinator Name</label>
                        <input type="text" id="coordinatorName">
                    </div>
                    <input type="hidden" id="createdBy" value="1">
                    <button type="submit">Create Event</button>
                </form>
                
                <h2 style="margin-top: 30px;">All Events</h2>
                <div id="eventList" class="event-list"></div>
            </div>
            
            <!-- Registrations Tab -->
            <div id="registrations" class="tab-content">
                <h2>Register for Event</h2>
                <div class="success-message" id="regSuccess"></div>
                <div class="error-message" id="regError"></div>
                <form id="registrationForm">
                    <div class="form-group">
                        <label>Select Event *</label>
                        <select id="regEventId" required></select>
                    </div>
                    <div class="form-group">
                        <label>Select Participant *</label>
                        <select id="regParticipantId" required></select>
                    </div>
                    <div class="form-group">
                        <label>Team Name (for group events)</label>
                        <input type="text" id="teamName">
                    </div>
                    <div class="form-group">
                        <label>Emergency Contact Name *</label>
                        <input type="text" id="emergencyContactName" required>
                    </div>
                    <div class="form-group">
                        <label>Emergency Contact Number *</label>
                        <input type="text" id="emergencyContactNumber" pattern="[0-9]{10}" required>
                    </div>
                    <button type="submit">Register</button>
                </form>
                
                <h2 style="margin-top: 30px;">All Registrations</h2>
                <div id="registrationList" class="event-list"></div>
            </div>
        </div>
    </div>
    
    <script>
        const API_URL = 'http://localhost:8080/api';
        
        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'registrations') {
                loadEventsForDropdown();
                loadUsersForDropdown();
            }
        }
        
        // Load Dashboard Stats
        async function loadStats() {
            try {
                const [events, users, registrations] = await Promise.all([
                    fetch(`${API_URL}/events/stats`).then(r => r.json()),
                    fetch(`${API_URL}/users/stats`).then(r => r.json()),
                    fetch(`${API_URL}/registrations/stats`).then(r => r.json())
                ]);
                
                document.getElementById('totalEvents').textContent = events.totalEvents || 0;
                document.getElementById('totalUsers').textContent = users.totalUsers || 0;
                document.getElementById('totalRegistrations').textContent = registrations.totalRegistrations || 0;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }
        
        // User Form Submit
        document.getElementById('userForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const userData = {
                fullName: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
                mobile: document.getElementById('mobile').value,
                userRole: document.getElementById('userRole').value,
                collegeId: document.getElementById('collegeId').value
            };
            
            try {
                const response = await fetch(`${API_URL}/users/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('userSuccess', 'User registered successfully!');
                    document.getElementById('userForm').reset();
                    loadUsers();
                    loadStats();
                } else {
                    showMessage('userError', result.message);
                }
            } catch (error) {
                showMessage('userError', 'Error: ' + error.message);
            }
        });
        
        // Event Form Submit
        document.getElementById('eventForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const eventData = {
                eventName: document.getElementById('eventName').value,
                eventDescription: document.getElementById('eventDescription').value,
                eventCategory: document.getElementById('eventCategory').value,
                eventType: document.getElementById('eventType').value,
                eventDate: document.getElementById('eventDate').value,
                eventStartTime: document.getElementById('eventStartTime').value,
                venue: document.getElementById('venue').value,
                maxRegistrations: parseInt(document.getElementById('maxRegistrations').value) || null,
                registrationStartDate: document.getElementById('registrationStartDate').value,
                registrationEndDate: document.getElementById('registrationEndDate').value,
                registrationFee: parseFloat(document.getElementById('registrationFee').value) || 0,
                coordinatorName: document.getElementById('coordinatorName').value,
                status: 'OPEN'
            };
            
            try {
                const response = await fetch(`${API_URL}/events?createdById=1`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(eventData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('eventSuccess', 'Event created successfully!');
                    document.getElementById('eventForm').reset();
                    loadEvents();
                    loadStats();
                } else {
                    showMessage('eventError', result.message);
                }
            } catch (error) {
                showMessage('eventError', 'Error: ' + error.message);
            }
        });
        
        // Registration Form Submit
        document.getElementById('registrationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const regData = {
                teamName: document.getElementById('teamName').value,
                emergencyContactName: document.getElementById('emergencyContactName').value,
                emergencyContactNumber: document.getElementById('emergencyContactNumber').value
            };
            
            const eventId = document.getElementById('regEventId').value;
            const participantId = document.getElementById('regParticipantId').value;
            
            try {
                const response = await fetch(`${API_URL}/registrations?eventId=${eventId}&participantId=${participantId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(regData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('regSuccess', 'Registration successful! Registration Number: ' + result.registration.registrationNumber);
                    document.getElementById('registrationForm').reset();
                    loadRegistrations();
                    loadStats();
                } else {
                    showMessage('regError', result.message);
                }
            } catch (error) {
                showMessage('regError', 'Error: ' + error.message);
            }
        });
        
        // Load Users
        async function loadUsers() {
            try {
                const response = await fetch(`${API_URL}/users`);
                const users = await response.json();
                
                const userList = document.getElementById('userList');
                userList.innerHTML = users.map(user => `
                    <div class="event-item">
                        <h3>${user.fullName}</h3>
                        <div class="event-details">
                            <p><strong>Email:</strong> ${user.email}</p>
                            <p><strong>Mobile:</strong> ${user.mobile || 'N/A'}</p>
                            <p><strong>Role:</strong> ${user.userRole}</p>
                            <p><strong>College ID:</strong> ${user.collegeId || 'N/A'}</p>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }
        
        // Load Events
        async function loadEvents() {
            try {
                const response = await fetch(`${API_URL}/events`);
                const events = await response.json();
                
                const eventList = document.getElementById('eventList');
                eventList.innerHTML = events.map(event => `
                    <div class="event-item">
                        <h3>${event.eventName}</h3>
                        <div class="event-details">
                            <p><strong>Code:</strong> ${event.eventCode}</p>
                            <p><strong>Category:</strong> ${event.eventCategory}</p>
                            <p><strong>Date:</strong> ${event.eventDate} at ${event.eventStartTime}</p>
                            <p><strong>Venue:</strong> ${event.venue}</p>
                            <p><strong>Registrations:</strong> ${event.currentRegistrations || 0} / ${event.maxRegistrations || '‚àû'}</p>
                            <span class="badge badge-${event.status === 'OPEN' ? 'open' : 'closed'}">${event.status}</span>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading events:', error);
            }
        }
        
        // Load Registrations
        async function loadRegistrations() {
            try {
                const response = await fetch(`${API_URL}/registrations`);
                const registrations = await response.json();
                
                const regList = document.getElementById('registrationList');
                regList.innerHTML = registrations.map(reg => `
                    <div class="event-item">
                        <h3>Registration #${reg.registrationNumber}</h3>
                        <div class="event-details">
                            <p><strong>Event:</strong> ${reg.event?.eventName || 'N/A'}</p>
                            <p><strong>Participant:</strong> ${reg.participant?.fullName || 'N/A'}</p>
                            <p><strong>Team:</strong> ${reg.teamName || 'N/A'}</p>
                            <p><strong>Status:</strong> ${reg.registrationStatus}</p>
                            <p><strong>Emergency Contact:</strong> ${reg.emergencyContactName} (${reg.emergencyContactNumber})</p>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading registrations:', error);
            }
        }
        
        // Load dropdowns for registration form
        async function loadEventsForDropdown() {
            try {
                const response = await fetch(`${API_URL}/events/status/OPEN`);
                const events = await response.json();
                
                const select = document.getElementById('regEventId');
                select.innerHTML = '<option value="">Select Event</option>' + 
                    events.map(event => `<option value="${event.id}">${event.eventName} (${event.eventDate})</option>`).join('');
            } catch (error) {
                console.error('Error loading events:', error);
            }
        }
        
        async function loadUsersForDropdown() {
            try {
                const response = await fetch(`${API_URL}/users/role/STUDENT`);
                const users = await response.json();
                
                const select = document.getElementById('regParticipantId');
                select.innerHTML = '<option value="">Select Participant</option>' + 
                    users.map(user => `<option value="${user.id}">${user.fullName} (${user.email})</option>`).join('');
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }
        
        // Show success/error messages
        function showMessage(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
            
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            loadUsers();
            loadEvents();
            loadRegistrations();
        });
    </script>
</body>
</html>